ef45b5b7-bac3-e6ba-27cf-9e23bcdab7d8


https://manjit28.medium.com/setting-up-a-secure-and-highly-available-hashicorp-vault-cluster-for-secrets-and-certificates-0ce01a370582

https://www.youtube.com/watch?v=PQh3sDaPJyg&t=144s

Next Steps

1. Need to create certs for vault

https://discuss.hashicorp.com/t/hashicorp-vault-error-initializing-listener-of-type-tcp-error-loading-tls-cert-where-is-my-mistake/17533


Enabling tls
1. update hcl file - /opt/vault/config.hcl and add
  tls_cert_file            = "/etc/vault.d/client.pem"
  tls_key_file             = "/etc/vault.d/cert.key"
  tls_disable_client_certs = true

2. after enabling tls use the below flag when using vault cli
export VAULT_SKIP_VERIFY=true
export VAULT_ADDR='https://192.168.0.25:8200'
export VAULT_TOKEN='hvs.ArVyUDJ5bb5pPwVqONsTVu2x'

Enabling LDAP authentication

vault write auth/ldap/config \
    url="ldap://idp.cloud.lab:389" \
    userattr="sAMAccountName" \
    userdn="ou=users,dc=ldap,dc=goauthentik,dc=io" \
    groupdn="ou=users,dc=ldap,dc=goauthentik,dc=io" \
    groupfilter="(&(objectClass=person)(uid={{.Username}}))" \
    groupattr="memberOf" \
    binddn="cn=akadmin,ou=users,dc=ldap,dc=goauthentik,dc=io" \
    bindpass="cloudaiyaz123"
    insecure_tls=true
    starttls=false