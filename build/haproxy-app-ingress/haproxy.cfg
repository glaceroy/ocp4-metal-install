# Global settings
#---------------------------------------------------------------------
global
    maxconn     20000
    log         /dev/log  local0 debug
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    log                     global
    log-format              "%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}r"
    mode                    http
    option                  httplog
    option                  dontlognull
    option                  http-server-close
    option                  redispatch
    option                  forwardfor       except 127.0.0.0/8
    retries                 3
    maxconn                 20000
    timeout http-request    10000ms
    timeout http-keep-alive 10000ms
    timeout check           10000ms
    timeout connect         40000ms
    timeout client          300000ms
    timeout server          300000ms
    timeout queue           50000ms

#---------------------------------------------------------------------
# HAProxy stats page
#---------------------------------------------------------------------
listen stats
    bind *:8404
    stats enable
    stats uri /
    stats refresh 10s

#---------------------------------------------------------------------
# OCP application http ingress frontend 
#---------------------------------------------------------------------
frontend ocp_http_app_ingress_frontend
    bind *:80
    mode http
    default_backend ocp_http_app_ingress_backend

#---------------------------------------------------------------------
# Backend pointing to OpenShift http ingress router nodes
#---------------------------------------------------------------------
backend ocp_http_app_ingress_backend
    balance roundrobin
    mode http
    server      worker01 10.10.0.211:31339 send-proxy check 
    server      worker02 10.10.0.212:31339 send-proxy check
