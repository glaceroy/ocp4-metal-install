---
- hosts: 127.0.0.1
  connection: local
  become: true

  vars:
    firewalld_rules:
      - { service: https, zone: internal }
      - { service: https, zone: external }
      - { service: dhcp, zone: internal }
      - { service: http, zone: internal }
      - { service: http, zone: external }
      - { service: mountd, zone: internal }
      - { service: rpc-bind, zone: internal }
      - { service: nfs, zone: internal }

    firewalld_ports:
      - { port: 53/udp, zone: internal }
      - { port: 53/tcp, zone: internal }
      - { port: 8080/tcp, zone: internal }
      - { port: 6443/tcp, zone: internal }
      - { port: 6443/tcp, zone: external }
      - { port: 22623/tcp, zone: internal }
      - { port: 9000/tcp, zone: external }

  tasks:
    - name: Enable firewalld services
      ansible.posix.firewalld:
        service: "{{ item.service }}"
        state: enabled
        zone: "{{ item.zone }}"
        permanent: true
        immediate: true
        offline: true
      loop: "{{ firewalld_rules }}"

    - name: Enable firewalld ports
      ansible.posix.firewalld:
        port: "{{ item.port }}"
        state: enabled
        zone: "{{ item.zone }}"
        permanent: true
      loop: "{{ firewalld_ports }}"
