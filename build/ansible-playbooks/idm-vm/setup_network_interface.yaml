---
- name: Setup network interface
  hosts: 127.0.0.1
  connection: local
  become: true

  vars:
    internal_interface: ens19
    external_interface: ens18
    internal_prefix: 24
    internal_ip: 10.10.0.2
    dns_server_ip: 10.10.0.1
    dns4_search_domains:
      - cloud.lab

  tasks:
    - name: Setup and configure LAN NIC for internal zone
      community.general.nmcli:
        conn_name: "{{ internal_interface }}"
        ifname: "{{ internal_interface }}"
        type: ethernet
        state: present
        autoconnect: yes
        ip4:
          - "{{ internal_ip }}/{{ internal_prefix }}"
        never_default4: true
        dns4:
          - "{{ dns_server_ip }}"
        dns4_search: "{{ dns4_search_domains }}"

    - name: Configure LAN NIC for external zone
      community.general.nmcli:
        conn_name: "{{ external_interface }}"
        ifname: "{{ external_interface }}"
        type: ethernet
        state: present
        dns4_ignore_auto: true
        dns4:
          - "{{ dns_server_ip }}"

    - name: Bring up internal interface
      ansible.builtin.command:
        cmd: nmcli connection up "{{ internal_interface }}"
      changed_when: false

    - name: Bring up external interface
      ansible.builtin.command:
        cmd: nmcli connection up "{{ external_interface }}"
      changed_when: false

