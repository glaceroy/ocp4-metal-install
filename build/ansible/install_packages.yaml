---
- hosts: 127.0.0.1
  connection: local
  tasks:
  - name: Package installation
    dnf:
      name:
        - git
        - wget
        - vim
        - bind
        - bind-utils
        - bash-completion
        - httpd
        - dhcp-server
        - haproxy
        - nfs-utils
      state: latest

  - name: Install kubectl
    ansible.builtin.get_url:
      url: https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/kubectl-linux-amd64.tar.gz
      dest: /usr/local/bin/kubectl
      mode: '0755'
      extract: yes

  - name: Install oc client
    ansible.builtin.get_url:
      url: https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz
      dest: /usr/local/bin/oc
      mode: '0755'
      extract: yes

  - name: Enable bash completion for oc
    ansible.builtin.shell: |
      echo 'source <(oc completion bash)' >> /etc/bashrc

  - name: Enable bash completion for kubectl
    ansible.builtin.shell: |
      echo 'source <(kubectl completion bash)' >> /etc/bashrc

  - name: Ensure bind is started and enabled
    systemd:
      name: named
      state: started
      enabled: yes

  - name: Ensure httpd is started and enabled
    systemd:
      name: httpd
      state: started
      enabled: yes  

  - name: Ensure dhcpd is started and enabled
    systemd:
      name: dhcpd
      state: started
      enabled: yes  

  - name: Ensure haproxy is started and enabled
    systemd:
      name: haproxy
      state: started  
      enabled: yes  

  - name: Ensure nfs-server is started and enabled
    systemd:
      name: nfs-server
      state: started  
      enabled: yes

